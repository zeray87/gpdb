CREATE EXTENSION pg_geohash;

DROP TABLE IF EXISTS poi;
CREATE TABLE poi(
        latitude	double precision,
		longitude	double precision,
        geohash		text,
		location	point
);

INSERT INTO poi (latitude, longitude) VALUES 
   (41.88312316336702, -87.73659457163214)  ,
   (41.791348021159834, -87.78192025331069) ,
   (41.842387914655085, -87.71337551836481) ,
   (41.755760706231364, -87.65956849676316) ,
   (41.80897612485923, -87.72254872914976)  ,
   (41.722449100658835, -87.58488176146959) ,
   (41.79087621277985, -87.65342904803647)  ,
   (41.780107932510866, -87.73487049029012) ,
   (41.768369162544815, -87.68797048054597) ,
   (41.847183350218096, -87.71106103128797) ,
   (41.75070078042353, -87.63439725625732)  ,
   (41.876025230855, -87.70949617323915)    ,
   (41.86698574675321, -87.72382153400046)  ,
   (41.94454673907203, -87.79009306423538)  ,
   (41.86199495131283, -87.72764278275724)  ,
   (41.719811440283024, -87.5636380070539)  ,
   (41.7499925263042, -87.60044819246234)   ,
   (41.7961127248025, -87.75907981055788)   ,
   (41.742918494975775, -87.5498300179199)  ,
   (41.91321195720614, -87.75993816620701)	;

UPDATE poi SET geohash = LAT_LON_TO_GEOHASH(latitude, longitude), location = point(latitude, longitude);

-- Query 1
SELECT * FROM poi;

-- Query 2
SELECT GEOHASH_TO_LAT_LON(LAT_LON_TO_GEOHASH(latitude, longitude)), location FROM poi;

-- Query 3
SELECT SUBSTRING(LAT_LON_TO_GEOHASH(latitude, longitude) FROM 1 for 5) geohash, COUNT(*)
FROM poi GROUP BY 1 ORDER BY 2 DESC;
